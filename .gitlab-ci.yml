stages:
  - test

variables:
  PIP_DISABLE_PIP_VERSION_CHECK: "1"
  PIP_NO_CACHE_DIR: "1"

# Use a recent Python image; uv is installed via pipx for speed where available
image: python:3.13-slim

before_script:
  - python --version
  - pip install --upgrade pip
  - pip install uv
  - uv pip install -e .

pytest:
  stage: test
  rules:
    - if: '$CI_COMMIT_BRANCH == "main" && $CI_PIPELINE_SOURCE == "push"'
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
  script:
    - pytest -q
  artifacts:
    when: always
    reports:
      junit: junit.xml
    paths:
      - junit.xml
    expire_in: 1 week

